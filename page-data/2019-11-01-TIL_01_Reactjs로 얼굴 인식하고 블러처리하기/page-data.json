{"componentChunkName":"component---src-templates-blog-post-js","path":"/2019-11-01-TIL_01_Reactjs로 얼굴 인식하고 블러처리하기/","result":{"data":{"site":{"siteMetadata":{"title":"@_@"}},"markdownRemark":{"id":"a410b6dd-848a-5504-a657-ff2648c1d468","excerpt":"🚀 TIL 01 🚀 실행결과~_~ 작업의 순서는 아래와 같다. 마무리","html":"<h1>🚀 TIL 01 🚀</h1>\n<br/>\n<br/>\n오늘 해야하는 작업은 웹에서 사용자가 입력한 이미지에서 얼굴을 인식하고 인식된 얼굴 부분을 블러 처리해서 처리된 이미지를 출력하는 웹 개발이었다.<br/>\n당연하게도 서버를 사용해서 Python으로 바로 실행하는게 낫긴 하지만.. 하지만 요청된 기능은 웹으로만 동작해야했기 때문에 조금 삽질을 했다.🗿\n<br/>\n<h1>실행결과~_~</h1>\n<br/>\nblur 처리된 내 얼굴\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9cfe021c3eac7345b95f17a58fa75ece/4a6a6/blured.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 124.40633245382587%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,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&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"blured\" title=\"blured\" src=\"/static/9cfe021c3eac7345b95f17a58fa75ece/799d3/blured.png\" srcset=\"/static/9cfe021c3eac7345b95f17a58fa75ece/00d96/blured.png 148w,\n/static/9cfe021c3eac7345b95f17a58fa75ece/0b23c/blured.png 295w,\n/static/9cfe021c3eac7345b95f17a58fa75ece/799d3/blured.png 590w,\n/static/9cfe021c3eac7345b95f17a58fa75ece/2a3d6/blured.png 885w,\n/static/9cfe021c3eac7345b95f17a58fa75ece/ae92f/blured.png 1180w,\n/static/9cfe021c3eac7345b95f17a58fa75ece/4a6a6/blured.png 1516w\" sizes=\"(max-width: 590px) 100vw, 590px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n<br/>\n<h1>작업의 순서는 아래와 같다.</h1>\n<br/>\n1. 사용자가 이미지 올림\n2. 이미지를 tensorflow모델에 입력값으로 넣어 출력된 좌표값을 저장\n3. 이미지를 canvas에 그리고, 좌표 배열을 읽어 좌표에 맞는 블러 처리된 타원을 canvas에 그린다.\n<br/>\n처음 생각했던 방법은 div 안에 자식 img와 blur처리하는 div를 한번에 이미지화하는 방법을 생각했는데, blur처리된 div는 이미지로 저장이 안되었다.<br/>\n그래서 두번째로 생각했던 방법은 canvas를 사용하여 blur 처리하는 방법이었고 이 방법으로 100% 요구된 기능을 구현하였다.<br/>\ncanvas를 처음 사용했기 때문에 조금 공부를 해야했긴 했지만 어렵지는 않았다.<br/>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 학습 모델 결과 값을 canvas 에 그린다.</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">printToFile</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// useRef 로 ref를 미리 선언한거를 가져온다.</span>\n<span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> myRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> img <span class=\"token operator\">=</span> imageRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> imageURL<span class=\"token punctuation\">,</span> detections<span class=\"token punctuation\">,</span> match <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> initState<span class=\"token punctuation\">;</span>\n\n    canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// resize를 하는 이유는 화면 크기에 따른 이미지 크기를 보여주기 위함</span>\n    <span class=\"token function\">resize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 아래 3줄은 '원본' 이미지를 그리는 소스</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">clearRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> canvas<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> canvas<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>filter <span class=\"token operator\">=</span> <span class=\"token string\">\"none\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// detections은 얼굴 인식된 값을 가지고 있음</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span>detections<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      detections<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">detection<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> _H <span class=\"token operator\">=</span> detection<span class=\"token punctuation\">.</span>box<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> _W <span class=\"token operator\">=</span> detection<span class=\"token punctuation\">.</span>box<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> _X <span class=\"token operator\">=</span> detection<span class=\"token punctuation\">.</span>box<span class=\"token punctuation\">.</span>_x<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> _Y <span class=\"token operator\">=</span> detection<span class=\"token punctuation\">.</span>box<span class=\"token punctuation\">.</span>_y<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> centerX <span class=\"token operator\">=</span> _X <span class=\"token operator\">+</span> _W <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> centerY <span class=\"token operator\">=</span> _Y <span class=\"token operator\">+</span> _H <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// blur 처리</span>\n        ctx<span class=\"token punctuation\">.</span>filter <span class=\"token operator\">=</span> <span class=\"token string\">\"blur(10px)\"</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// parameter</span>\n        <span class=\"token comment\">// centerX, centerY, raduis, 0, 2*Math.PI(는 타원));</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">arc</span><span class=\"token punctuation\">(</span>centerX<span class=\"token punctuation\">,</span> centerY<span class=\"token punctuation\">,</span> _H <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">clip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">const</span> temp <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>initState <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    temp<span class=\"token punctuation\">.</span>loading <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setInitState</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 동적으로 뷰를 뿌리기 위해서 사용하는 부분</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">resize</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resize\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> myRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">var</span> ratio <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">/</span> canvas<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> canvas_height <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>innerHeight<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> canvas_width <span class=\"token operator\">=</span> canvas_height <span class=\"token operator\">*</span> ratio<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>canvas_width <span class=\"token operator\">></span> window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      canvas_width <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>innerWidth<span class=\"token punctuation\">;</span>\n      canvas_height <span class=\"token operator\">=</span> canvas_width <span class=\"token operator\">/</span> ratio<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    canvas<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> canvas_width <span class=\"token operator\">+</span> <span class=\"token string\">\"px\"</span><span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> canvas_height <span class=\"token operator\">+</span> <span class=\"token string\">\"px\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br/>\n<br/>\n<h1>마무리</h1>\n<br/>\ncanvas의 사용법을 공부했다 :0\n```","frontmatter":{"title":"TIL_01_Reactjs로 얼굴 인식하고 블러처리하기","date":"November 01, 2019","description":null}}},"pageContext":{"slug":"/2019-11-01-TIL_01_Reactjs로 얼굴 인식하고 블러처리하기/","previous":{"fields":{"slug":"/2019-10-20-Flask이용해서 딥러닝 학습 모델 API 만들기/"},"frontmatter":{"title":"Flask이용해서 딥러닝 학습 모델 API 만들기"}},"next":{"fields":{"slug":"/2019-12-06-CSS 사진 1:1 or 비율로 만들기/"},"frontmatter":{"title":"CSS 사진 1:1 or 비율로 만들기"}}}}}