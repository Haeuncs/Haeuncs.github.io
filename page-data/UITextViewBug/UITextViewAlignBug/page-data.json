{"componentChunkName":"component---src-templates-blog-post-js","path":"/UITextViewBug/UITextViewAlignBug/","result":{"data":{"site":{"siteMetadata":{"title":"방가방가"}},"markdownRemark":{"id":"34e2ad0b-a169-5cd3-bf7d-4ccde234c3a6","excerpt":"1. 서론 Swift 를 개발하면서 TextView의 textAlignment를 center로 사용해본 적이 없었기 때문에 이 버그를 이번에 처음 봤습니다. 이슈 ticket을 받고 디버그를 찍어보고, playground 에서 demo…","html":"<h1 id=\"1-서론\" style=\"position:relative;\"><a href=\"#1-%EC%84%9C%EB%A1%A0\" aria-label=\"1 서론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 서론</h1>\n<p>Swift 를 개발하면서 TextView의 textAlignment를 center로 사용해본 적이 없었기 때문에 이 버그를 이번에 처음 봤습니다.</p>\n<p>이슈 ticket을 받고 디버그를 찍어보고, playground 에서 demo 프로젝트를 만들면서 이 버그가 기본 버그라는 것을 알게 되었습니다.</p>\n<p>버그는 쉽게 볼 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">  \n<span class=\"token keyword\">import</span> <span class=\"token class-name\">UIKit</span>\n<span class=\"token keyword\">import</span> <span class=\"token class-name\">PlaygroundSupport</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MyViewController</span> <span class=\"token punctuation\">:</span> <span class=\"token class-name\">UIViewController</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">loadView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> view <span class=\"token operator\">=</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        view<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span>white\n\n        <span class=\"token keyword\">let</span> label <span class=\"token operator\">=</span> <span class=\"token class-name\">UITextView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        label<span class=\"token punctuation\">.</span>frame <span class=\"token operator\">=</span> <span class=\"token class-name\">CGRect</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">:</span> <span class=\"token number\">150</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n        label<span class=\"token punctuation\">.</span>textAlignment <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span>center\n        label<span class=\"token punctuation\">.</span>textColor <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span>black\n        label<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span>brown\n        \n        view<span class=\"token punctuation\">.</span><span class=\"token function\">addSubview</span><span class=\"token punctuation\">(</span>label<span class=\"token punctuation\">)</span>\n\n\n        <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>view <span class=\"token operator\">=</span> view\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre></div>\n<p>기본 UITextView의 이미지처럼 2줄의 텍스트를 입력하고 1줄에서 줄바꿈을 하면?! 이렇게 cursor 위치가 center 가 아닌 left로 이동합니다.</p>\n<h1 id=\"2-버그-해결하기\" style=\"position:relative;\"><a href=\"#2-%EB%B2%84%EA%B7%B8-%ED%95%B4%EA%B2%B0%ED%95%98%EA%B8%B0\" aria-label=\"2 버그 해결하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 버그 해결하기</h1>\n<p>이 버그를 구글링을 하다보면 가장 유명한 (애초에 버그 report가 몇 개 없음) <a href=\"https://stackoverflow.com/questions/26524431/uitextview-alignment-caret-goes-left/53295470#53295470\">stackoverflow</a>와 같은 해결 방법이 나옵니다.</p>\n<p>해결 방법은 앞서 설명한 버그를 실행시키는 경우를 대비하여 작성된 코드인데 현재 상태를 판단해서 중앙으로 cursor 를 위치하게 하는 코드입니다.</p>\n<p>이 fix 의 문제는 <code class=\"language-text\">NSLocationInRange(NSMaxRange(rangeOfCharAfterCaret), fullRange)</code> 를 사용해서 판단하는데 허점이 있습니다.</p>\n<p>아래와 같이 입력해보면?</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">some</span> <span class=\"token function\">text</span><span class=\"token punctuation\">(</span>new <span class=\"token punctuation\">\\</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">\\</span>n</code></pre></div>\n<p>여러 줄의 텍스트 사이에 줄바꿈을 하는 것이 아닌 끝 줄에서 버그를 발생시키면 다시 버그가 발생됩니다.</p>\n<p>그래서 경우의 수를 하나 더 추가해서 해결합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">        <span class=\"token keyword\">let</span> isEndOfString <span class=\"token operator\">=</span> <span class=\"token class-name\">NSMaxRange</span><span class=\"token punctuation\">(</span>rangeOfCharAfterCaret<span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> <span class=\"token class-name\">NSMaxRange</span><span class=\"token punctuation\">(</span>fullRange<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n            text<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span>with<span class=\"token punctuation\">:</span> rangeOfCharBeforeCaret<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string-literal\"><span class=\"token string\">\"\\n\"</span></span>\n        </code></pre></div>\n<h1 id=\"3-전체-소스-코드\" style=\"position:relative;\"><a href=\"#3-%EC%A0%84%EC%B2%B4-%EC%86%8C%EC%8A%A4-%EC%BD%94%EB%93%9C\" aria-label=\"3 전체 소스 코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 전체 소스 코드</h1>\n<p>전체 코드는 <a href=\"https://gist.github.com/Haeuncs/197e8dc11fad49528ed638526cc7beca\">Gist</a>에 올려두었습니다. 😮</p>","tableOfContents":"<ul>\n<li><a href=\"#1-%EC%84%9C%EB%A1%A0\">1. 서론</a></li>\n<li><a href=\"#2-%EB%B2%84%EA%B7%B8-%ED%95%B4%EA%B2%B0%ED%95%98%EA%B8%B0\">2. 버그 해결하기</a></li>\n<li><a href=\"#3-%EC%A0%84%EC%B2%B4-%EC%86%8C%EC%8A%A4-%EC%BD%94%EB%93%9C\">3. 전체 소스 코드</a></li>\n</ul>","frontmatter":{"title":"UITextView textAlignment center bug fix!","date":"2020年07月02日","description":"UITextView의 기본 버그... 고치기 위한 여정"}}},"pageContext":{"slug":"/UITextViewBug/UITextViewAlignBug/","previous":{"fields":{"slug":"/bug/No account with App Store connect access have been found for team/"},"frontmatter":{"title":"No account with App Store connect access have been found for team 오류를 해결해보자"},"tableOfContents":"<ul>\n<li><a href=\"#%EC%A7%80%EA%B8%88%EA%B9%8C%EC%A7%80-%EC%95%8C%EB%A0%A4%EC%A7%84-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95%EB%93%A4\">지금까지 알려진 해결 방법들</a></li>\n<li><a href=\"#%EB%8B%A4-%ED%95%B4%EB%8F%84-%EB%8B%A4-%EC%95%88%EB%90%A8-%F0%9F%A4%AF\"><em>다 해도 다 안됨 🤯</em></a></li>\n</ul>"},"next":{"fields":{"slug":"/DDD/DDD 동아리를 마치며/"},"frontmatter":{"title":"DDD. 동아리를 마치며"},"tableOfContents":"<ul>\n<li><a href=\"#ddd-%EB%8F%99%EC%95%84%EB%A6%AC%EB%A5%BC-%EB%A7%88%EC%B9%98%EB%A9%B0\">DDD. 동아리를 마치며</a></li>\n</ul>"}}},"staticQueryHashes":["426816048","63159454"]}