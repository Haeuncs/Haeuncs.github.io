{"expireTime":9007200848448148000,"key":"transformer-remark-markdown-html-9cd0d46ffa4374071db0b6573a77e510-gatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":"<p>Swift 를 개발하면서 TextView의 textAlignment를 center로 사용해본 적이 없었기 때문에 이 버그를 이번에 처음 알게 되었습니다.</p>\n<p>이슈 ticket을 받고 디버그를 찍어보고, playground 에서 demo 프로젝트를 만들면서 이 버그가 기본 버그라는 것을 알게 되었습니다.</p>\n<p>버그는 쉽게 볼 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  \nimport UIKit\nimport PlaygroundSupport\n\nclass MyViewController : UIViewController {\n    override func loadView() {\n        let view = UIView()\n        view.backgroundColor = .white\n\n        let label = UITextView()\n        label.frame = CGRect(x: 150, y: 200, width: 200, height: 200)\n        label.textAlignment = .center\n        label.textColor = .black\n        label.backgroundColor = .brown\n        \n        view.addSubview(label)\n\n\n        self.view = view\n    }\n}</code></pre></div>\n<p>기본 UITextView의 이미지처럼 2줄의 텍스트를 입력하고 1줄에서 줄바꿈을 하면?! 이렇게 cursor 위치가 center 가 아닌 left로 이동합니다.</p>\n<p>이 버그를 구글링을 하다보면 가장 유명한 (애초에 버그 report가 몇 개 없다)<a href=\"https://stackoverflow.com/questions/26524431/uitextview-alignment-caret-goes-left/53295470#53295470\">stackoverflow</a>와 같은 해결 방법이 나옵니다.</p>\n<p>해결 방법은 앞서 설명한 버그를 실행시키는 경우를 대비하여 작성된 코드이다. 현재 상태를 판단해서 중앙으로 cursor 를 위치하게 하는 코드입니다.</p>\n<p>이 fix 의 문제는 <code class=\"language-text\">NSLocationInRange(NSMaxRange(rangeOfCharAfterCaret), fullRange)</code> 를 사용해서 판단하는데 허점이 있습니다.</p>\n<p>아래와 같이 입력해보면?</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">some text(new \\n)\\n</code></pre></div>\n<p>을 실행해봅시다.</p>\n<p>여러 줄의 텍스트 사이에 줄바꿈을 하는 것이 아닌 끝 줄에서 버그를 발생시키면 다시 버그가 발생됩니다. </p>\n<p>그래서 경우의 수를 하나 더 추가해서 해결합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">        let isEndOfString = NSMaxRange(rangeOfCharAfterCaret) &gt;= NSMaxRange(fullRange) &amp;&amp;\n            text.substring(with: rangeOfCharBeforeCaret) == &quot;\\n&quot;\n        </code></pre></div>\n<p>전체 코드는 <a href=\"https://gist.github.com/Haeuncs/197e8dc11fad49528ed638526cc7beca\">Gist</a>에 올려두었습니다.</p>"}