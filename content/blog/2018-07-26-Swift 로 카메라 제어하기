---
title: 1. Swift ë¡œ ì¹´ë©”ë¼ ì œì–´í•˜ê¸°
date: 2018-07-26 00:00:00
categories:
- Swift
tags:
- Swift
- ìŠ¤ìœ„í”„íŠ¸
cheers:
- what?
---  

ì´ í¬ìŠ¤íŠ¸ëŠ” Swift4ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.<br/>
Swiftì—ì„œ ì¹´ë©”ë¼ ì œì–´ ê³µì‹ ë¬¸ì„œëŠ” [docs](https://developer.apple.com/documentation/avfoundation/avcapturesession) ì—¬ê¸°ì„œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## SWIFT ì—ì„œ ì¹´ë©”ë¼ ì œì–´í•˜ê¸° - ì„œë¡ 
> ì–¸ì œ ì¹´ë©”ë¼ ì œì–´í•˜ê¸°ê°€ í•„ìš”í•œê°€?

ë§Œì•½ ë‚˜ë§Œì˜ ì¹´ë©”ë¼ í•„í„° ì•±ì´ ê°€ì§€ê³  ì‹¶ê±°ë‚˜ ì¹´ë©”ë¼ë¥¼ í†µí•´ì„œ ì–»ê³ ì í•˜ëŠ” ì •ë³´ê°€ ìˆì„ ë•Œ ì‚¬ìš©í•œë‹¤.<br/>
í•„ìëŠ” í˜„ì¬ ê°œë°œí•˜ê³  ìˆëŠ” ì•±ì— ê°€ì¥ ê¸°ì´ˆê°€ ë˜ëŠ” ì‹¬ë°•ìˆ˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ì„œ ì‚¬ìš©í•˜ì˜€ë‹¤.<br/>
í•œê¸€ë¡œ ì‘ì„±ëœ ì¹´ë©”ë¼ ì œì–´ì— ëŒ€í•œ ì„¤ëª…ì„ ì°¾ê¸° í˜ë“¤ì—ˆê³  êµ¬ê¸€ë§ì„ í•´ë„ ë²„ì „ì´ ë§ì§€ ì•ŠëŠ” ì½”ë“œë“¤ì´ ë‚˜ì™€ í”„ë¡œê·¸ë¨ ì‘ì„±ì— ì• ë¥¼ ë¨¹ì—ˆë‹¤. <br/>
ë¬¼ë¡  ë‹¤ì‹œ ì½”ë“œë¥¼ ëŒì•„ ë´¤ì„ ë• ë„ˆë¬´ ê°„ë‹¨í•˜ë‹¤.ğŸ˜®<br/>
ì–´ì°Œë˜ì—ˆë“  í•„ìì²˜ëŸ¼ Swiftì— ì²˜ìŒ ì ‘ê·¼í•´ ë³´ëŠ” ì‚¬ëŒì´ ì´ ê¸€ì„ ì½ê³  ë„ì›€ì„ ì–»ì–´ ê°”ìœ¼ë©´ í•œë‹¤.<br/>
<br/>

## SWIFT ì—ì„œ ì¹´ë©”ë¼ ì œì–´í•˜ê¸° - ë³¸ë¡ 
AVfoundation ì€ ì˜¤ë””ì˜¤ë‚˜ ì¹´ë©”ë¼ ì‘ì—…ì„ í¬í•¨í•˜ëŠ” í”„ë ˆì„ ì›Œí¬ì´ë‹¤.<br/>

í¬ê²Œ ì„¸ê°€ì§€ë¡œ êµ¬ì„±ëœë‹¤.<br/>
AVCaptureSession : ë°ì´í„°ì˜ íë¦„ì„ ê´€ë¦¬í•˜ëŠ” ì„¸ì…˜

AVCaptureDevice : ì…ë ¥ ì¥ì¹˜ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.

AVCaptureOutput : ì¶œë ¥ì„ ë‚˜íƒ€ë‚¸ë‹¤.
<br/>

ì‘ì„±í•œ ì½”ë“œëŠ” í”„ë ˆì„ë§ˆë‹¤ ì‹¤í–‰ë˜ëŠ” captureOutputì—ì„œ ì´ë¯¸ì§€ì˜ RGB ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•˜ëŠ” í”„ë¡œê·¸ë¨ì´ë‹¤.<br/>
ë³´í†µ ì´ë¯¸ì§€ë¥¼ ë°›ì•„ì„œ captureOutputì—ì„œ ìˆ˜ì •í•˜ê¸° ë•Œë¬¸ì— í•„ìš”í•œ ì•±ì— ë”°ë¼ captureOutputì„ ë°”ê¾¸ë©´ ë˜ê² ë‹¤.<br/>

ëª¨ë“  ì½”ë“œì— ì£¼ì„ì„ ì‘ì„±í•˜ì˜€ë‹¤.
### ì „ì²´ ì†ŒìŠ¤ ì½”ë“œ
```Swift
//
//  ViewController.swift
//  SWIFT_1_camera
//
//  Created by OOPSLA on 2018. 7. 26..
//  Copyright Â© 2018ë…„ OOPSLA. All rights reserved.
//

import UIKit
import AVFoundation

class ViewController: UIViewController,AVCaptureVideoDataOutputSampleBufferDelegate {
    //storyboardì—ì„œ ë§Œë“  View
    @IBOutlet weak var CameraView: UIView!

    //ì¹´ë©”ë¼ë¥¼ ì œì–´í•  í•¨ìˆ˜
    func Camera(){
        let captureSession = AVCaptureSession()
        //ì„¤ì • ë³€ê²½ ì „ beginConfiguration í˜¸ì¶œí•˜ê³ 
        captureSession.beginConfiguration()
        //ìº¡ì²˜ í’ˆì§ˆ
        captureSession.sessionPreset = AVCaptureSession.Preset.vga640x480
        //commitConfiguration ì„¤ì • ë°˜ì˜
        captureSession.commitConfiguration()
        //ì¥ì¹˜ ì„¤ì •
        let videoDevice = AVCaptureDevice.default(for: .video)
        //frame ì„¤ì •
        videoDevice?.activeVideoMinFrameDuration = CMTimeMake(1, 30)
        do{
            let videoInput = try AVCaptureDeviceInput(device: videoDevice!)
            captureSession.addInput(videoInput)
        }catch{
            print("\(error)")
            return
        }
        //í™”ë©´ ì¶œë ¥ ë¶€ë¶„
        let previewLayer = AVCaptureVideoPreviewLayer.init(session: captureSession)
        //video setting í•˜ê³  viewì— í˜„ì¬ í™”ë©´ ì¶œë ¥
        previewLayer.frame = CameraView.bounds
        CameraView.layer.addSublayer(previewLayer)

        let videoOutput = AVCaptureVideoDataOutput()
        ////ìƒˆ ë¹„ë””ì˜¤ ìƒ˜í”Œ ë²„í¼ê°€ ìº¡ì²˜ë˜ë©´ captureOutput (_ : didOutput : from :)ì„ ì‚¬ìš©í•˜ì—¬ ìƒ˜í”Œ ë²„í¼ ëŒ€ë¦¬ì¸ì—ê²Œ ì „ì†¡.
        let videoOutputQueue = DispatchQueue(label: "VideoQueue")
        videoOutput.setSampleBufferDelegate(self, queue: videoOutputQueue)
        captureSession.addOutput(videoOutput)

        //32bit BGRA í¬ë§·
        videoOutput.videoSettings = [kCVPixelBufferPixelFormatTypeKey as AnyHashable as! String: Int(kCVPixelFormatType_32BGRA)]
        videoOutput.alwaysDiscardsLateVideoFrames = true

        //ì„¸ì…˜ ì‹œì‘
        captureSession.startRunning()
    }
    //ì„¤ì •ëœ í”„ë ˆì„ë§ˆë‹¤ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ (ìœ„ì—ì„œ 30í”„ë ˆì„ìœ¼ë¡œ ì„¤ì •í•¨)
    func captureOutput(_ captureOutput: AVCaptureOutput, didOutput sampleBuffer: CMSampleBuffer, from connection: AVCaptureConnection) {
        let imageBuffer = CMSampleBufferGetImageBuffer(sampleBuffer)!
        //ì´ì§€ë¯¸ ë²„í¼ lock
        CVPixelBufferLockBaseAddress(imageBuffer, CVPixelBufferLockFlags(rawValue: CVOptionFlags(0)))
        //imagevBufferì˜ í¬ê¸°ë¥¼ ê°€ì ¸ì˜´
        let height = CVPixelBufferGetHeight(imageBuffer)
        let width = CVPixelBufferGetWidth(imageBuffer)

        let baseAddress = CVPixelBufferGetBaseAddress(imageBuffer)!
        let byteBuffer = baseAddress.assumingMemoryBound(to: UInt8.self)

        //RGB ê°’ ê°€ì ¸ì™€ì„œ ì½˜ì†”ì°½ì— print
        for j in 0..<height {
            for i in 0..<width {
                let index = (j * width + i) * 4
                print(" B : \(byteBuffer[index])")
                print(" G : \(byteBuffer[index+1])")
                print(" R : \(byteBuffer[index+2])")
                }
        }
        //ì´ë¯¸ì§€ ë²„í¼ unlock
        CVPixelBufferUnlockBaseAddress(imageBuffer, CVPixelBufferLockFlags(rawValue: CVOptionFlags(0)))
    }
    override func viewDidLoad() {
        super.viewDidLoad()
        Camera()
        // Do any additional setup after loading the view, typically from a nib.
    }

    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }


}

```
### ğŸ’¥swift ì—ì„œ ì¹´ë©”ë¼ë¥¼ ì œì–´í•  ë•ŒëŠ” ì¹´ë©”ë¼ ê¶Œí•œì„ ì£¼ì–´ì•¼ í•œë‹¤.!ğŸ’¥

![info.plist](/assets/images/07-26/info.07.17.png)
listì— ì»¤ì„œë¥¼ ë†“ìœ¼ë©´ + - í‘œì‹œê°€ ë‚˜ì˜¬í…ë° + ëˆ„ë¥´ê³  privacy - camera usage description ì„ ì°¾ì•„ì„œ ì¶”ê°€í•˜ë©´ ëœë‹¤.
<br/>
## SWIFTì—ì„œ ì¹´ë©”ë¼ ì œì–´í•˜ê¸° - ì‹¤í–‰
![ì‹¤í–‰ê²°ê³¼](/assets/images/07-26/IMG_0001.png)
![ì‹¤í–‰ê²°ê³¼](/assets/images/07-26/IMG_0002.png)
<br/>
ì½˜ì†” ì‹¤í–‰ ê²°ê³¼<br/>
![ì½˜ì†”ê²°ê³¼](/assets/images/07-26/result.png)
## ì „ì²´ ì†ŒìŠ¤ ì½”ë“œ (github)
[GitHub](https://github.com/Haeuncs/Swift_github_post/tree/master/SWIFT_1_camera) ì—¬ê¸°ì„œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Any question?ğŸ™‹â€
Please email me with any questions or concerns! ğŸ˜ƒ<br/>
ğŸ’Œ : sch.haeun@gmail.com
